---
import BaseLayout from '../layouts/BaseLayout.astro';
import AlertBox from '../components/AlertBox.astro';
import LatestActivity from '../components/LatestActivity.astro';
// Server-only/build-time: determine whether to show Discord invite
const discordInviteEnabled = String(import.meta.env.DISCORD_SERVER_INVITE ?? "")
  .toLowerCase()
  .trim() === "true";
const discordInviteUrl: string | undefined = (() => {
  try {
    const fromImport = import.meta.env.DISCORD_INVITE_URL as string | undefined;
    const fromProcess = typeof process !== 'undefined' ? process.env.DISCORD_INVITE_URL : undefined;
    return fromImport || fromProcess;
  } catch {
    return typeof process !== 'undefined' ? process.env.DISCORD_INVITE_URL : undefined;
  }
})();
const showDiscordInvite = discordInviteEnabled && !!discordInviteUrl;
---

<BaseLayout title="Home">
  <section class="mb-10">
    <h1 class="text-3xl font-bold text-term-green uppercase">SHART.CLOUD</h1>
    <p class="text-term-green/80 mt-2">Cloud security education done in a ðŸ’© way.</p>

    <div class="mt-4 flex gap-4 text-sm">
      <a class="navbar-link" href="/ctf">CTFs</a>
      <a class="navbar-link" href="/labs">Labs</a>
      <a class="navbar-link" href="/blog">Blog</a>
    </div>
  </section>

  {!showDiscordInvite && (
    <div class="mb-10">
      <AlertBox variant="warning" title="Heads up" class="shadow-md">
        Discord server coming soon?
      </AlertBox>
    </div>
  )}

  <LatestActivity limit={6} include={["blog", "labs"]} />
</BaseLayout>
